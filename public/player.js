!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.jPlayer=t():e.jPlayer=t()}(window,(function(){return function(e){var t={};function o(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,o),i.l=!0,i.exports}return o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(r,i,function(t){return e[t]}.bind(null,i));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3)}([function(e,t,o){var r,i;r="undefined"!=typeof window?window:this,i=function(e,t){const o={kFileData:1,kInitDecoderReq:0,kUninitDecoderReq:1,kOpenDecoderReq:2,kCloseDecoderReq:3,kFeedDataReq:4,kStartDecodingReq:5,kPauseDecodingReq:6,kInitDecoderRsp:0,kUninitDecoderRsp:1,kOpenDecoderRsp:2,kCloseDecoderRsp:10,kVideoFrame:4,kAudioFrame:5,kDecodeFinishedEvt:8,cmdCallback:11,kGetParamRsp:12,sendDataCallback:13,socketLinkState:14,getHeartBeatRequest:15,DownloaderHeartBeat:16,closeWebsocket:17,fetchStream:18,resetDecoderFifo:19,getSetPlayBackSpeedReq:20,getSetPlayBackStartReq:21,deviceReady:22,getSetPlayBackStartTimeReq:23,responseCurDateTime:24,eventTypeFifoFull:25,eventTypeFifoEnough:26,playbakcRecordList:27,socketActiveClose:28,serverDataTimeout:29,heartPingResp:30,serverDecoderError:31,socketNoActive:32,getHandsharkReq:33,getHandsharkRes:34,onWasmLoaded:35,serverDeviceUnLink:36,errorStrLog:37};return e.common=o,o},"object"==typeof e.exports?e.exports=r.document?i(r):function(e){if(!e.document)throw new Error("common requires a window with a document");return i(e)}:i(r)},function(e,t,o){"use strict";e.exports=function(e,t,o,r){var i=self||window;try{try{var s;try{s=new i.Blob([e])}catch(t){(s=new(i.BlobBuilder||i.WebKitBlobBuilder||i.MozBlobBuilder||i.MSBlobBuilder)).append(e),s=s.getBlob()}var n=i.URL||i.webkitURL,a=n.createObjectURL(s),l=new i[t](a,o);return n.revokeObjectURL(a),l}catch(r){return new i[t]("data:application/javascript,".concat(encodeURIComponent(e)),o)}}catch(e){if(!r)throw Error("Inline worker is not supported");return new i[t](r,o)}}},function(e,t,o){var r,i;r="undefined"!=typeof window?window:this,i=function(e,t){function o(e){this.module=e}return o.prototype.log=function(e){},o.prototype.logError=function(e){},o.prototype.logInfo=function(e){},o.prototype.logDebug=function(e){},o.prototype.currentTimeStr=function(){var e=new Date(Date.now());return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+":"+e.getMilliseconds()},e.Logger=o,o},"object"==typeof e.exports?e.exports=r.document?i(r):function(e){if(!e.document)throw new Error("Logger requires a window with a document");return i(e)}:i(r)},function(e,t,o){"use strict";function r(e){this.init(e)}o.r(t),o.d(t,"playerStateIdle",(function(){return S})),o.d(t,"playerStatePlaying",(function(){return b})),o.d(t,"playerStatePausing",(function(){return T})),r.prototype.init=function(e){this.option={encoding:"16bitInt",channels:1,sampleRate:8e3,flushingTime:5e3,...e},this.samples=new Float32Array,this.flush=this.flush.bind(this),this.interval=setInterval(this.flush,this.option.flushingTime),this.maxValue=this.getMaxValue(),this.TypedArray=this.getTypedArray(),this.createContext()},r.prototype.getMaxValue=function(){var e={"8bitInt":128,"16bitInt":32768,"32bitInt":2147483648,"32bitFloat":1};return e[this.option.encoding]?e[this.option.encoding]:e["16bitInt"]},r.prototype.getTypedArray=function(){var e={"8bitInt":Int8Array,"16bitInt":Int16Array,"32bitInt":Int32Array,"32bitFloat":Float32Array};return e[this.option.encoding]?e[this.option.encoding]:e["16bitInt"]},r.prototype.createContext=function(){this.audioCtx=new(window.AudioContext||window.webkitAudioContext),this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioCtx.destination),this.startTime=this.audioCtx.currentTime},r.prototype.isTypedArray=function(e){return e.byteLength&&e.buffer&&e.buffer.constructor==ArrayBuffer},r.prototype.feed=function(e){if(this.isTypedArray(e)){e=this.getFormatedValue(e);var t=new Float32Array(this.samples.length+e.length);t.set(this.samples,0),t.set(e,this.samples.length),this.samples=t}},r.prototype.getFormatedValue=function(e){e=new this.TypedArray(e.buffer);var t,o=new Float32Array(e.length);for(t=0;t<e.length;t++)o[t]=e[t]/this.maxValue;return o},r.prototype.volume=function(e){this.gainNode.gain.value=e},r.prototype.destroy=function(){this.interval&&clearInterval(this.interval),this.samples=null,this.audioCtx.close(),this.audioCtx=null},r.prototype.createAudioAssembly=function(e){var t,o,r,i,s,n=this.audioCtx.createBufferSource(),a=e.length/this.option.channels,l=this.audioCtx.createBuffer(this.option.channels,a,this.option.sampleRate);for(o=0;o<this.option.channels;o++)for(t=l.getChannelData(o),r=o,s=50,i=0;i<a;i++)t[i]=e[r],i<50&&(t[i]=t[i]*i/50),i>=a-51&&(t[i]=t[i]*s--/50),r+=this.option.channels;this.startTime<this.audioCtx.currentTime&&(this.startTime=this.audioCtx.currentTime),n.buffer=l,n.connect(this.gainNode),n.start(this.startTime),this.startTime+=l.duration},r.prototype.flush=function(){this.samples.length&&(this.createAudioAssembly(this.samples),this.samples=new Float32Array)},r.prototype.getTimestamp=function(){return this.audioCtx?this.audioCtx.currentTime:0},r.prototype.play=function(e){this.isTypedArray(e)&&(e=this.getFormatedValue(e)).length&&this.createAudioAssembly(e)},r.prototype.pause=function(){"running"===this.audioCtx.state&&this.audioCtx.suspend()},r.prototype.resume=function(){"suspended"===this.audioCtx.state&&this.audioCtx.resume()};var i=r;function s(e){this.gl=e,this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}function n(e,t){this.canvas=e,this.gl=e.getContext("webgl",t)||e.getContext("experimental-webgl"),this.program=null,this.verticesBuffer=null,this.texCoordBuffer=null,this.initGL(t)}s.prototype.fill=function(e,t,o){var r=this.gl;r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.LUMINANCE,e,t,0,r.LUMINANCE,r.UNSIGNED_BYTE,o)},n.prototype.initGL=function(e){if(this.gl){var t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,1);var o=t.createProgram();this.program=o;var r=["attribute highp vec4 aVertexPosition;","attribute vec2 aTextureCoord;","varying highp vec2 vTextureCoord;","void main(void) {"," gl_Position = aVertexPosition;"," vTextureCoord = aTextureCoord;","}"].join("\n"),i=t.createShader(t.VERTEX_SHADER);t.shaderSource(i,r),t.compileShader(i);var n=["precision highp float;","varying lowp vec2 vTextureCoord;","uniform sampler2D YTexture;","uniform sampler2D UTexture;","uniform sampler2D VTexture;","const mat4 YUV2RGB = mat4","("," 1.1643828125, 0, 1.59602734375, -.87078515625,"," 1.1643828125, -.39176171875, -.81296875, .52959375,"," 1.1643828125, 2.017234375, 0, -1.081390625,"," 0, 0, 0, 1",");","void main(void) {"," gl_FragColor = vec4( texture2D(YTexture, vTextureCoord).x, texture2D(UTexture, vTextureCoord).x, texture2D(VTexture, vTextureCoord).x, 1) * YUV2RGB;","}"].join("\n"),a=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(a,n),t.compileShader(a),t.attachShader(o,i),t.attachShader(o,a),t.linkProgram(o),t.deleteShader(i),t.deleteShader(a),t.useProgram(o),t.getProgramParameter(o,t.LINK_STATUS);var l=t.getAttribLocation(o,"aVertexPosition");t.enableVertexAttribArray(l);var c=t.getAttribLocation(o,"aTextureCoord");t.enableVertexAttribArray(c);var d=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,d),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0]),t.STATIC_DRAW),t.vertexAttribPointer(l,3,t.FLOAT,!1,0,0);var h=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,h),t.bufferData(t.ARRAY_BUFFER,new Float32Array([1,0,0,0,1,1,0,1]),t.STATIC_DRAW),t.vertexAttribPointer(c,2,t.FLOAT,!1,0,0),this.verticesBuffer=d,this.texCoordBuffer=h,t.y=new s(t),t.u=new s(t),t.v=new s(t),t.y.bind(0,o,"YTexture"),t.u.bind(1,o,"UTexture"),t.v.bind(2,o,"VTexture")}},n.prototype.renderFrame=function(e,t,o,r,i){if(this.gl){var s=this.gl;s.viewport(0,0,s.canvas.width,s.canvas.height),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.y.fill(t,o,e.subarray(0,r)),s.u.fill(t>>1,o>>1,e.subarray(r,r+i)),s.v.fill(t>>1,o>>1,e.subarray(r+i,e.length)),s.drawArrays(s.TRIANGLE_STRIP,0,4)}},n.prototype.fullscreen=function(){var e=this.canvas;e.RequestFullScreen?e.RequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():alert("This browser doesn't supporter fullscreen")},s.prototype.bind=function(e,t,o){var r=this.gl;r.activeTexture([r.TEXTURE0,r.TEXTURE1,r.TEXTURE2][e]),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(r.getUniformLocation(t,o),e)},n.prototype.exitfullscreen=function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():alert("Exit fullscreen doesn't work")},n.prototype.webGLDestroy=function(){var e=this.gl,t=this.program;e.deleteProgram(t);var o=this.verticesBuffer,r=this.texCoordBuffer;e.deleteBuffer(o),e.deleteBuffer(r);var i=e.y.texture,s=e.u.texture,n=e.v.texture;e.deleteTexture(i),e.deleteTexture(s),e.deleteTexture(n),this.canvas=null,this.gl=null};var a=n,l=o(1),c=o.n(l);function d(){return c()('!function(e){var o={};function t(a){if(o[a])return o[a].exports;var r=o[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,t),r.l=!0,r.exports}t.m=e,t.c=o,t.d=function(e,o,a){t.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,o){if(1&o&&(e=t(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var r in e)t.d(a,r,function(o){return e[o]}.bind(null,r));return a},t.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(o,"a",o),o},t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},t.p="",t(t.s=0)}([function(e,o){function t(){this.logger=new Logger("Decoder"),this.coreLogLevel=1,this.wasmLoaded=!1,this.tmpReqQue=[],this.cacheBuffer=null,this.decodeTimer=null,this.videoCallback=null,this.audioCallback=null,this.eventCallback=null,this.decoderCmdCallback=null}self.Module={onRuntimeInitialized:function(){self.decoder&&self.decoder.onWasmLoaded()},locateFile:function(e,o){return location.origin+"/"+e}},self.importScripts(location.origin+"/enumConstant.js"),self.importScripts(location.origin+"/logger.js"),self.importScripts(location.origin+"/libffmpeg.js"),t.prototype.initDecoder=function(e,o,t,a,r){var s=Module._initDecoder(this.coreLogLevel,this.eventCallback,this.decoderCmdCallback,0);if(this.logger.logInfo("initDecoder return "+s+"."),0==s){if(t&&""!=t&&a&&""!=a&&r&&""!=r){var l=allocateUTF8(t),n=allocateUTF8(a),c=allocateUTF8(r);Module._setCipherInfo(c,l,n)}null==this.cacheBuffer&&(this.cacheBuffer=Module._malloc(o)),Module._setPlayMode(e)}var i={t:common.kInitDecoderRsp,e:s};self.postMessage(i)},t.prototype.uninitDecoder=function(){this.closeDecoder();var e=Module._uninitDecoder();this.logger.logInfo("Uninit ffmpeg decoder return "+e+"."),null!==this.cacheBuffer&&(Module._free(this.cacheBuffer),this.cacheBuffer=null)},t.prototype.getParam=function(e){var o,t,a,r,s,l,n,c,i,d,u=2002==e?3:4,f=Module._malloc(4*u),g=2002==e?Module._getAudioParam(f,u):Module._getVideoParam(f,u);this.logger.logInfo("getParam return "+g),0==g?(t=f>>2,a=Module.HEAP32.subarray(t,t+u),r=2002==e?"":a[0],s=2002==e?"":a[1],l=2002==e?"":a[2],n=2002==e?"":a[3],c=2002==e?a[0]:"",i=2002==e?a[1]:"",d=2002==e?a[2]:"",o={t:common.kGetParamRsp,e:g,type:2002==e?"audio":"video",v:{d:r,p:s,w:l,h:n},a:{f:c,c:i,r:d}},self.postMessage(o)):(o={t:common.kGetParamRsp,e:g},self.postMessage(o)),Module._free(f)},t.prototype.openDecoder=function(){var e,o=Module._openDecoder(this.videoCallback,this.audioCallback);this.logger.logInfo("openDecoder return "+o),0==o&&(e={t:common.kOpenDecoderRsp,e:o},self.postMessage(e))},t.prototype.closeDecoder=function(){!1,a=!1,this.logger.logInfo("closeDecoder."),this.decodeTimer&&(clearInterval(this.decodeTimer),this.decodeTimer=null,this.logger.logInfo("Decode timer stopped."));var e=Module._closeDecoder();this.logger.logInfo("Close ffmpeg decoder return "+e+".");var o={t:common.kCloseDecoderRsp,e:0};self.postMessage(o)},t.prototype.startDecoding=function(e){this.logger.logInfo("Start decoding."),this.decodeTimer&&clearInterval(this.decodeTimer),this.decodeTimer=setInterval(this.decode,e)},t.prototype.pauseDecoding=function(){this.logger.logInfo("Pause decoding."),this.decodeTimer&&(clearInterval(this.decodeTimer),this.decodeTimer=null)};t.prototype.decode=function(){var e=Module._malloc(4),o=Module._decodeOnePacket(e);for(7==o&&self.decoder.logger.logInfo("Decoder finished."),0==o&&!0;9==o&&this.decodeTimer;)o=Module._decodeOnePacket(e);Module._free(e)},t.prototype.sendData=function(e){var o=new Uint8Array(e);Module.HEAPU8.set(o,this.cacheBuffer),Module._sendData(this.cacheBuffer,o.length),o=null},t.prototype.getSetPlayBackSpeedReq=function(e){var o,t,a,r,s,l=Module._malloc(4),n=Module._malloc(1024),c=allocateUTF8(e),i=Module._getSetPlayBackSpeedReq(n,l,1024,c);this.logger.logInfo("_getSetPlayBackSpeedReq return "+i),0==i&&(t=l>>2,a=Module.HEAP32.subarray(t,t+1)[0],r=Module.HEAPU8.subarray(n,n+a),s=new Uint8Array(r),o={t:common.getSetPlayBackSpeedReq,b:s},self.postMessage(o),s=null),Module._free(l),Module._free(n)},t.prototype.getSetPlayBackStartReq=function(){var e,o,t,a,r,s=Module._malloc(4),l=Module._malloc(1024),n=Module._getSetPlayBackStartReq(l,s,1024);this.logger.logInfo("_getSetPlayBackStartReq return "+n),0==n&&(o=s>>2,t=Module.HEAP32.subarray(o,o+1)[0],a=Module.HEAPU8.subarray(l,l+t),r=new Uint8Array(a),e={t:common.getSetPlayBackStartReq,b:r},self.postMessage(e)),Module._free(s),Module._free(l)},t.prototype.getSetPlayBackStartTimeReq=function(e){var o,t,a,r,s,l=Module._malloc(4),n=Module._malloc(1024),c=allocateUTF8(String(e)),i=Module._getSetPlayBackStartTimeReq(n,l,1024,c);this.logger.logInfo("_getSetPlayBackStartTimeReq return "+i),0==i&&(t=l>>2,a=Module.HEAP32.subarray(t,t+1)[0],r=Module.HEAPU8.subarray(n,n+a),s=new Uint8Array(r),o={t:common.getSetPlayBackStartTimeReq,b:s},self.postMessage(o)),Module._free(l),Module._free(n)},t.prototype.getHeartbeatPing=function(){var e,o,t,a,r,s=Module._malloc(4),l=Module._malloc(1024),n=Module._getHeartbeatPing(l,s,1024);this.logger.logInfo("_getHeartbeatPing return "+n),0==n&&(o=s>>2,t=Module.HEAP32.subarray(o,o+1)[0],a=Module.HEAPU8.subarray(l,l+t),r=new Uint8Array(a),e={t:common.getHeartBeatRequest,b:r,l:t},self.postMessage(e)),Module._free(s),Module._free(l)},t.prototype.getHandsharkReq=function(){var e,o,t,a,r,s=Module._malloc(4),l=Module._malloc(1024),n=Module._getHandsharkReq(l,s,1024);this.logger.logInfo("_getHeartbeatPing return "+n),0==n&&(o=s>>2,t=Module.HEAP32.subarray(o,o+1)[0],a=Module.HEAPU8.subarray(l,l+t),r=new Uint8Array(a),e={t:common.getHandsharkRes,b:r,l:t},self.postMessage(e)),Module._free(s),Module._free(l)},t.prototype.processReq=function(e){switch(e.t){case common.kInitDecoderReq:this.initDecoder(e.s,e.c,e.k,e.i,e.ct);break;case common.kUninitDecoderReq:this.uninitDecoder();break;case common.kOpenDecoderReq:this.openDecoder();break;case common.kCloseDecoderReq:this.closeDecoder();break;case common.kStartDecodingReq:this.startDecoding(e.i);break;case common.kPauseDecodingReq:this.pauseDecoding();break;case common.kFeedDataReq:this.sendData(e.d);break;case common.getHeartBeatRequest:this.getHeartbeatPing();break;case common.resetDecoderFifo:this.resetDecoderFifo();break;case common.getSetPlayBackSpeedReq:this.getSetPlayBackSpeedReq(e.l);break;case common.getSetPlayBackStartReq:this.getSetPlayBackStartReq();break;case common.getSetPlayBackStartTimeReq:this.getSetPlayBackStartTimeReq(e.s);break;case common.getHandsharkReq:this.getHandsharkReq();break;default:this.logger.logError("Unsupport messsage "+e.t)}},t.prototype.cacheReq=function(e){e&&this.tmpReqQue.push(e)},t.prototype.resetDecoderFifo=function(e){Module._resetDecoderFifo()};var a=!1;t.prototype.onWasmLoaded=function(){this.logger.logInfo("Wasm loaded."),this.wasmLoaded=!0,this.videoCallback=Module.addFunction((function(e,o,t){var a=Module.HEAPU8.subarray(e,e+o),r=new Uint8Array(a),s={t:common.kVideoFrame,s:t,d:r};self.postMessage(s,[s.d.buffer]),r=null}),"viid"),this.audioCallback=Module.addFunction((function(e,o,t){var a=Module.HEAPU8.subarray(e,e+o),r=new Uint8Array(a),s={t:common.kAudioFrame,s:t,d:r};self.postMessage(s,[s.d.buffer]),r=null}),"viid"),this.decoderCmdCallback=Module.addFunction((function(e,o,t,a,r,s,l){var n,c,i,d,u;switch(e){case 1:d={t:common.deviceReady},self.postMessage(d);break;case 2:break;case 3:i={t:common.responseCurDateTime,d:r},self.postMessage(i);break;case 4:break;case 8:c=UTF8ToString(s,l),n={t:common.playbakcRecordList,d:c},self.postMessage(n);break;case 9:u={t:common.heartPingResp},self.postMessage(u)}}),"vijiijii");const e=this;this.eventCallback=Module.addFunction((function(o,t){if(o>=4&&o<=18){const e={t:common.serverDecoderError,s:o};self.postMessage(e)}switch(o){case 0:if(!a){const e={t:common.sendDataCallback};self.postMessage(e),a=!0}break;case 1:case 2:case 3:const t={t:common.socketLinkState,s:o};self.postMessage(t);break;case 2e3:const r={t:common.eventTypeFifoFull};self.postMessage(r);break;case 2001:const s={t:common.eventTypeFifoEnough};self.postMessage(s);break;case 2002:e.getParam(2002);break;case 2003:e.getParam(2003);break;case 17:const l={t:common.serverDataTimeout};self.postMessage(l);break;default:const n={t:common.serverDeviceUnLink,s:o};self.postMessage(n)}}),"vii");let o={t:common.onWasmLoaded};var t;for(self.postMessage(o);this.tmpReqQue.length>0;)t=this.tmpReqQue.shift(),this.processReq(t)},self.decoder=new t,self.onmessage=function(e){if(self.decoder){var o=e.data;if(!self.decoder.wasmLoaded)return self.decoder.cacheReq(o),void self.decoder.logger.logInfo("Temp cache req "+o.t+".");self.decoder.processReq(o)}}}]);',"Worker",void 0,o.p+"decoder.worker:c4c4e572.js")}function h(){return c()('!function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(o,s,function(t){return e[t]}.bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t){function r(){this.logger=new Logger("Downloader"),this.ws=null,this.heartbeatTimer=null,this.heartbeatTimes=0}self.importScripts(location.origin+"/enumConstant.js"),self.importScripts(location.origin+"/logger.js"),r.prototype.appendBuffer=function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r.buffer},r.prototype.reportData=function(e){var t={t:common.kFileData,d:e};self.postMessage(t,[t.d])},r.prototype.requestWebsocket=function(e,t){var r,o=this;null===this.ws?(this.ws=new WebSocket(e),this.ws.binaryType="arraybuffer",this.ws.onopen=function(e){o.logger.logInfo("Ws connected."),o.heartbeatTimes=0},this.ws.onerror=function(e){o.logger.logError("Ws connect error "+e.data),o.heartbeatTimes=0},this.ws.onclose=function(e){clearInterval(o.heartbeatTimer),o.ws=null,r={t:common.socketActiveClose,d:e.code,w:e.wasClean},self.postMessage(r),o.heartbeatTimes=0},this.ws.onmessage=this.onmessage.bind(this)):this.ws.onmessage=this.onmessage.bind(this)},r.prototype.onmessage=function(e){this.heartbeatTimes=0;var t=e.data;t.byteLength>10485760||self.downloader.reportData(t)},r.prototype.startHeartbeatTimer=function(e){this.ws&&(clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval((()=>{this.ws.send(e),this.heartbeatTimes=this.heartbeatTimes+1,this.heartbeatTimes>3&&(this.ws.close(),clearInterval(this.heartbeatTimer),this.ws=null,req={t:common.socketNoActive},self.postMessage(req),this.heartbeatTimes=0)}),13e3))},r.prototype.closeWebsocket=function(e){this.ws&&(this.ws.close(),clearInterval(this.heartbeatTimer),this.ws=null)},r.prototype.setPlayBackSpeed=function(e){this.ws&&this.ws.send(e)},r.prototype.setPlayBackStart=function(e){this.ws&&this.ws.send(e)},r.prototype.SetPlayBackStartTime=function(e){this.ws&&this.ws.send(e)},r.prototype.heartPingResp=function(){this.heartbeatTimes=0},self.downloader=new r,self.onmessage=function(e){if(self.downloader){var t=e.data;switch(t.t){case common.fetchStream:self.downloader.requestWebsocket(t.url,t.msg);break;case common.DownloaderHeartBeat:self.downloader.startHeartbeatTimer(t.b);break;case common.closeWebsocket:self.downloader.closeWebsocket();break;case common.getSetPlayBackSpeedReq:self.downloader.setPlayBackSpeed(t.b);break;case common.getSetPlayBackStartReq:self.downloader.setPlayBackStart(t.b);break;case common.getSetPlayBackStartTimeReq:self.downloader.SetPlayBackStartTime(t.b);break;case common.heartPingResp:self.downloader.heartPingResp();break;default:self.downloader.logger.logError("Unsupport messsage "+t.t)}}}}]);',"Worker",void 0,o.p+"downloader.worker:43d798dd.js")}var u=o(2),p=o.n(u);new p.a("Event").logInfo("Event.js 已加载");class f{constructor(e){this.target={},this.eventsQueue={},this.disallowRepeat=!1}add(e=[],t,o){for(let r of e)this.on(r,t,o)}on(e,t,o){if(void 0===this.eventsQueue[e]&&(this.eventsQueue[e]={methods:[],once:!1}),"function"==typeof t){if(!this.disallowRepeat||!this.eventsQueue[e].methods.includes(t))return this.eventsQueue[e].methods.push(t),void 0!==o&&(this.eventsQueue[e].once=o),this.target}else logger.error("on","the argument is not function.",t)}once(e,t){this.on(e,t,!0)}off(e,t){let o=this.eventsQueue[e];if(!o)return;let r=o.methods;if(t){let e=r.length;for(;e--;)r[e]===t&&r.splice(e,1)}else delete this.eventsQueue[e];return this.target}emit(e,...t){let o=this.eventsQueue[e];if(o)return o.methods.forEach((e=>{e.apply(this.target,t)})),o.once&&this.off(e),this.target}clear(e){delete this.eventsQueue[e]}clearAll(){this.eventsQueue={}}}var m=function(e){const t=new f(e);return e=>(t.target=e,t)};var g=o(0),y=o.n(g);function v(e){if(!e)return;this.canvasContainer=e,e.style.position="relative";const t=parseInt(getComputedStyle(e).width),o=parseInt(getComputedStyle(e).height);this.conW=t,this.conH=o;const r=document.createElement("canvas");r.width=t,r.height=o,r.style.cssText="transform: scale(1);transform-origin: 0 0;",r.setAttribute("class","videoCanvas"),this.msg="链接已断开";const i=document.createElement("div");i.style.cssText="position: absolute;z-index: 2;background-color: rgba(0, 0, 0, 0);margin: 0;top: 0;right: 0;bottom: 0;left: 0;",e.appendChild(r),i.setAttribute("class","videoCanvasMsg"),e.appendChild(i);this.container_el=e,this.canvas=r,this.stateContainer_el=i,this.loading_el_str='<div style="top: 50%;margin-top: -21px;width: 100%;text-align: center;position: absolute;"><svg t="1607391066926" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1837" width="20" height="20"><path d="M512 64q14.016 0 23.008 8.992T544 96v192q0 14.016-8.992 23.008T512 320t-23.008-8.992T480 288V96q0-14.016 8.992-23.008T512 64z m0 640q14.016 0 23.008 8.992T544 736v192q0 14.016-8.992 23.008T512 960t-23.008-8.992T480 928v-192q0-14.016 8.992-23.008T512 704z m448-192q0 14.016-8.992 23.008T928 544h-192q-14.016 0-23.008-8.992T704 512t8.992-23.008T736 480h192q14.016 0 23.008 8.992T960 512z m-640 0q0 14.016-8.992 23.008T288 544H96q-14.016 0-23.008-8.992T64 512t8.992-23.008T96 480h192q14.016 0 23.008 8.992T320 512zM195.008 195.008q10.016-8.992 23.008-8.992t22.016 8.992l136 136q8.992 10.016 8.992 22.496t-9.504 22.016-22.016 9.504-22.496-8.992l-136-136q-8.992-8.992-8.992-22.016t8.992-23.008zM648 648q10.016-10.016 22.496-10.016t22.496 10.016l136 136q8.992 8.992 8.992 22.016t-9.504 22.496-22.496 9.504-22.016-8.992l-136-136q-10.016-10.016-10.016-22.496t10.016-22.496z m180.992-452.992q8.992 10.016 8.992 23.008t-8.992 22.016l-136 136q-10.016 8.992-22.496 8.992t-22.016-9.504-9.504-22.016 8.992-22.496l136-136q8.992-8.992 22.016-8.992t23.008 8.992zM376 648q10.016 10.016 10.016 22.496t-10.016 22.496l-136 136q-8.992 8.992-22.016 8.992t-22.496-9.504-9.504-22.496 8.992-22.016l136-136q10.016-10.016 22.496-10.016t22.496 10.016z" p-id="1838" fill="#409EFF"></path></svg><p style="color: #409EFF;margin: 3px 0;font-size: 14px;">视频拼命加载中...</p></div>',this.pauseimg_el_str='<div id="iconPlay" style="width: 120px;height: 120px;position: absolute;left: 50%;top: 50%;transform: translate(-50%,-50%);" class="iconPlay"><svg t="1606101743943" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2807" width="120" height="120"><path d="M195.68 960c-14.19 0-28.37-3.73-41.31-11.2-25.86-14.93-41.3-41.68-41.3-71.54V146.74c0-29.86 15.44-56.61 41.3-71.54s56.74-14.94 82.6 0l632.66 365.27c25.86 14.93 41.3 41.66 41.3 71.52 0.01 29.87-15.43 56.61-41.3 71.54L236.97 948.8c-12.93 7.47-27.12 11.2-41.29 11.2z m0.13-840.9c-6.35 0-11.39 2.33-13.91 3.78-4.13 2.39-13.77 9.5-13.77 23.85v730.53c0 14.34 9.63 21.46 13.77 23.85 4.14 2.39 15.1 7.17 27.53 0L842.1 535.85c12.43-7.18 13.77-19.07 13.77-23.85 0-4.78-1.34-16.67-13.77-23.84L209.44 122.89c-4.88-2.81-9.53-3.79-13.63-3.79z m660.05 440.59h0.14-0.14z" fill="#333333" p-id="2808"></path></svg></div>',this.msg_el_str="",this.stateContainer_el.innerHTML=""}v.prototype._showOrHideShade=function(e){this.stateContainer_el.style.backgroundColor=e},v.prototype.showPauseIcon=function(){this._showOrHideShade("rgba(0,0,0,0)"),this.stateContainer_el.innerHTML=this.pauseimg_el_str},v.prototype.showLoading=function(){this._showOrHideShade("rgba(0,0,0,0)")},v.prototype.showMsg=function(e){this._showOrHideShade("rgba(0,0,0,0)")},v.prototype.hideAll=function(){this._showOrHideShade("rgba(0,0,0,0)"),this.msg="",this.stateContainer_el.innerHTML=""};var R=v;var E={4:{code:4,code16:4,eventStr:"SERVER_UNKNOWN_ERROR",msg:"服务器未知错误"},5:{code:5,code16:5,eventStr:"SERVER_NOT_READY",msg:"服务器未准备好"},6:{code:6,code16:6,eventStr:"SERVER_USER_ABORT",msg:"服务器端用户主动断开"},7:{code:7,code16:7,eventStr:"SERVER_STOPPED",msg:"服务器服务已停止"},8:{code:8,code16:8,eventStr:"SERVER_ABORT",msg:"服务器服务已中断"},9:{code:9,code16:9,eventStr:"SERVER_STREAM_STOP",msg:"服务器流停止"},10:{code:10,code16:10,eventStr:"SERVER_CONNECT_DEV_FAILED",msg:"连接设备失败"},11:{code:11,code16:11,eventStr:"SERVER_SUBDEV_STREAM_ERR",msg:"订阅设备流失败"},12:{code:12,code16:12,eventStr:"SERVER_INVALID_CONTEXT",msg:"不合法的上下文"},13:{code:13,code16:13,eventStr:"SERVER_DEVICE_TIMEOUT",msg:"设备超时"},14:{code:14,code16:14,eventStr:"SERVER_CLIENT_TIMEOUT",msg:"客户端超时"},15:{code:15,code16:15,eventStr:"SERVER_OVER_DEV_LIMIT",msg:"超过设备最大连接数"},16:{code:16,code16:16,eventStr:"SERVER_PERM_DENIED",msg:"无权限"},17:{code:17,code16:17,eventStr:"SERVER_DATA_TIMEOUT",msg:"数据超时"},18:{code:18,code16:18,eventStr:"SERVER_DEVICE_ABORT",msg:"服务器端设备主动断开"}};const S=0,b=1,T=2;function k(e){this.url=e.url,this.endtime=e.endtime,this.isStream=e.isStream,this.k=e.encrypted_key,this.i=e.encrypted_iv,this.ct=e.encrypted_type,this.streamHighWaterFrame=e.streamHighWaterFrame?e.streamHighWaterFrame:25,this.playbackHighWaterFrame=e.playbackHighWaterFrame?e.playbackHighWaterFrame:25,this.playbackLowWaterFrame=e.playbackLowWaterFrame?e.playbackLowWaterFrame:10}function _(e){var t;this.version="1.1.1.20210323",this.el=e,this.observer=null,this.event=m(this)(),(t=this.event).on("SERVER_UNKNOWN_ERROR",(e=>{t.emit("UNKNOWN_ERROR",e)})),t.on("SERVER_NOT_READY",(e=>{t.emit("NOT_READY",e)})),t.on("SERVER_USER_ABORT",(e=>{t.emit("USER_ABORT",e)})),t.on("SERVER_STOPPED",(e=>{t.emit("STOPPED",e)})),t.on("SERVER_ABORT",(e=>{t.emit("ABORT",e)})),t.on("SERVER_STREAM_STOP",(e=>{t.emit("STREAM_STOP",e)})),t.on("SERVER_CONNECT_DEV_FAILED",(e=>{t.emit("CONNECT_DEV_FAILED",e)})),t.on("SERVER_SUBDEV_STREAM_ERR",(e=>{t.emit("SUBDEV_STREAM_ERR",e)})),t.on("SERVER_INVALID_CONTEXT",(e=>{t.emit("INVALID_CONTEXT",e)})),t.on("SERVER_DEVICE_TIMEOUT",(e=>{t.emit("DEVICE_TIMEOUT",e)})),t.on("SERVER_CLIENT_TIMEOUT",(e=>{t.emit("CLIENT_TIMEOUT",e)})),t.on("SERVER_OVER_DEV_LIMIT",(e=>{t.emit("OVER_DEV_LIMIT",e)})),t.on("SERVER_PERM_DENIED",(e=>{t.emit("PERM_DENIED",e)})),t.on("SERVER_DATA_TIMEOUT",(e=>{t.emit("DATA_TIMEOUT",e)})),t.on("SERVER_DEVICE_ABORT",(e=>{t.emit("DEVICE_ABORT",e)})),t.on("CLIENT_lINK_ERROR_ONE",(e=>{t.emit("CLIENT_LINK_ERROR",e)})),t.on("CLIENT_lINK_ERROR_THREE",(e=>{t.emit("CLIENT_LINK_ERROR_THREE",e)})),t.on("MEDIA_ERROR",(e=>{t.emit("GET_MEDIA_ERROR",e)})),t.on("MEDIA_PROGRESS_INFO",(e=>{t.emit("GET_MEDIA_PROGRESS_INFO",e)})),t.on("DEVICE_RECORD_LIST",(e=>{t.emit("GET_DEVICE_RECORD_LIST",e)})),t.on("MEDIA_PLAY",(()=>{t.emit("GET_MEDIA_PLAY")})),t.on("MEDIA_PAUSE",(()=>{t.emit("GET_MEDIA_PAUSE")})),t.on("MEDIA_STOP",(()=>{t.emit("GET_MEDIA_STOP")})),t.on("MEDIA_INFO",(e=>{t.emit("GET_MEDIA_INFO",e)})),this.configInfo=null,this.pcmPlayer=null,this.canvas=null,this.webglPlayer=null,this.frameRate=0,this.pixFmt=0,this.videoWidth=0,this.videoHeight=0,this.yLength=0,this.uvLength=0,this.playerState=S,this.socketSending=!1,this.decoding=!1,this.currentTimestamp="",this.audioEncoding="",this.audioChannels=0,this.audioSampleRate=0,this.sampleFmt=0,this.speedNum=2,this.setFrameRate=1,this.seeking=!1,this.loadingDiv=null,this.loadingState=!0,this.buffering=!1,this.frameBuffer=[],this.isStream=!1,this.logger=new p.a("Player"),this.drawingState=!1,this.speeding=!1,this.playInitState=!0,this.playFirstGetParams=!0,this.requestAnimationFrame=null,this.serverDeviceUnLinkCode=null,this.decoderErrorFlag=!1,this.endtime=null,this.initDownloadWorker(),this.initDecodeWorker();const o=new R(e);this.showPauseIcon=()=>{o.showPauseIcon()},this.showLoading=()=>{o.showLoading()},this.showMsg=e=>{o.showMsg(e)},this.hideAll=()=>{o.hideAll()},this._msgController=o;this.observer=new MutationObserver((e=>{if(this.videoHeight&&this.videoWidth&&this._msgController){let e=Math.ceil(1e5*parseInt(getComputedStyle(this.el).width)/this.videoWidth)/1e5,t=Math.ceil(1e5*parseInt(getComputedStyle(this.el).height)/this.videoHeight)/1e5;this.canvas.style.cssText=`transform: scale(${e},${t});transform-origin: 0 0;`}})),this.observer.observe(this._msgController.canvasContainer,{attributes:!0})}_.prototype.initDownloadWorker=function(){var e=this;this.downloadWorker=new h,this.downloadWorker.onmessage=function(t){var o=t.data;switch(o.t){case y.a.kFileData:e.onFileData(o.d);break;case y.a.socketActiveClose:e.onsocketActiveClose(o.d,o.w);break;case y.a.socketNoActive:e.onsocketNoActive()}}},_.prototype.initDecodeWorker=function(){var e=this;this.decodeWorker=new d,this.decodeWorker.onmessage=function(t){var o=t.data;const r={[y.a.kInitDecoderRsp]:"onInitDecoder",[y.a.kOpenDecoderRsp]:"onOpenDecoder",[y.a.kVideoFrame]:"onVideoFrame",[y.a.kAudioFrame]:"onAudioFrame",[y.a.kDecodeFinishedEvt]:"onDecodeFinished",[y.a.sendDataCallback]:"onSendDataCallback",[y.a.kGetParamRsp]:"onGetParam",[y.a.socketLinkState]:"onSocketLinkState",[y.a.getHeartBeatRequest]:"onGetHeartBeatRequest",[y.a.getSetPlayBackSpeedReq]:"onGetSetPlayBackSpeedReq",[y.a.getSetPlayBackStartReq]:"onGetSetPlayBackStartReq",[y.a.deviceReady]:"onDeviceReady",[y.a.getSetPlayBackStartTimeReq]:"onGetSetPlayBackStartTimeReq",[y.a.responseCurDateTime]:"onResponseCurDateTime",[y.a.eventTypeFifoFull]:"onEventTypeFifoFull",[y.a.eventTypeFifoEnough]:"onEventTypeFifoEnough",[y.a.playbakcRecordList]:"onPlaybakcRecordList",[y.a.serverDataTimeout]:"onServerDataTimeout",[y.a.serverDecoderError]:"onDecoderError",[y.a.heartPingResp]:"onHeartPingResp",[y.a.getHandsharkRes]:"onGetHandsharkRes",[y.a.kCloseDecoderRsp]:"onCloseDecoderRsp",[y.a.onWasmLoaded]:"onWasmLoaded",[y.a.serverDeviceUnLink]:"onserverDeviceUnLink",[y.a.errorStrLog]:"onErrorCodeLog"};r[o.t]&&e[r[o.t]](o)}},_.prototype.onErrorCodeLog=function(e){this.event.emit("onErrorCodeLog",e)},_.prototype.onserverDeviceUnLink=function(e){this.event.emit("onErrorCodeLog",e.s),this.serverDeviceUnLinkCode=e.s},_.prototype.play=function(e){this.frameBuffer.length=0,this.frameBuffer=[];let{url:t,endtime:o,isStream:r,i:i,k:s,t:n}=e,l={e:0,m:"Success"},c=this;{if(this.playerState==T)return l=this.resume(),l;if(this.playerState==b)return l;if(!t)return l={e:-1,m:"Invalid url"},this.logger.logError("[ER] playVideo error, url empty."),l;if(!r&&!o)return l={e:-1,m:"Invalid endtime"},this.logger.logError("[ER] playVideo error, endtime empty."),l;if(!("AES-256-GCM"!=n||i&&s))return l={e:-1,m:"Invalid params"},this.logger.logError("[ER] playVideo error, params empty."),l;if(!this.downloadWorker)return l={e:-1,m:"Downloader not initialized"},this.logger.logError("[ER] Downloader not initialized."),l;if(!this.decodeWorker)return l={e:-1,m:"Decoder not initialized"},this.logger.logError("[ER] Decoder not initialized."),l;this.canvas=this._msgController.canvas,this.configInfo=new k(e),this.playerState=b,this.isStream=r,this.endtime=o,this.webglPlayer=new a(this.canvas,{preserveDrawingBuffer:!0,antialias:!0}),this.displayLoop();const d={t:y.a.kInitDecoderReq,s:this.isStream?0:1,c:4194304,k:this.configInfo.k,i:this.configInfo.i,ct:this.configInfo.ct};this.decodeWorker.postMessage(d);let h=!1;this.registerVisibilityEvent((function(e){e&&c.playerState==b?c.isStream?1==h&&(c.pcmPlayer&&c.pcmPlayer.resume(),c.decodeWorker.postMessage({t:y.a.resetDecoderFifo}),c.startDecoding(),h=!1):1==h&&(c.resume(),h=!1):c.isStream&&c.playerState==b?(h=!0,c.pcmPlayer&&c.pcmPlayer.pause(),c.pauseDecoding()):c.playerState==b&&(c.pause(),h=!0)})),this.buffering=!0,this.loadingState=!0,this.hideAll(),this.event.emit("MEDIA_PLAY")}return l},_.prototype.seekTo=function(e){let t={e:-1,m:"Parameter Null."};if(!e)return this.logger.logError("[ER] seekTo error, time empty."),t;if(this.playerState!=b)return t.m="Player Is NotPlaying",t;this.seeking=!0,this.speeding=!1,this.pauseDecoding(),this.decodeWorker.postMessage({t:y.a.resetDecoderFifo}),this.frameBuffer.length=0;const o={t:y.a.getSetPlayBackStartTimeReq,s:e};return this.decodeWorker.postMessage(o),t.e=0,t.m="SeekTo Success.",t},_.prototype.setSpeed=function(e){let t={e:-1,m:"Parameter Null."};if(!e)return this.logger.logError("[ER] seekTo error, time empty."),t;if(["0","0.125","0.25","0.5","1","2","4","8"].findIndex((t=>t==e))>-1){this.speed(e),this.event.emit("speedNum",e);const o=parseFloat(e);return o>1&&(this.speeding=!0,this.setFrameRate=this.setFrameRateFn(),this.speedNum=2*o,this.restartAudio()),o>0&&o<1&&(this.speeding=!0,this.speedNum=2,0!=this.frameRate&&(this.setFrameRate=Math.floor(this.setFrameRateFn()/o)),this.restartAudio()),1!=o&&0!=o||(this.speeding=!1,this.speedNum=2,this.setFrameRate=this.setFrameRateFn()),t.e=0,t.m="SetSpeed Success.",t}return t.m="Invalid Parameter.",t},_.prototype.pause=function(){let e={e:-1,m:"Not playing"};if(!this.isStream)return this.playerState!=b||(this.playerState=T,this.pcmPlayer&&this.pcmPlayer.pause(),this.setSpeed("0"),this.pauseDecoding(),this.showPauseIcon(),this.event.emit("MEDIA_PAUSE"),e.e=0,e.m="Pause Success."),e},_.prototype.resume=function(){this.logger.logInfo("Resume.");let e={e:-1,m:"Not pausing"};return this.playerState!=T||(this.playerState=b,this.pcmPlayer&&this.pcmPlayer.resume(),this.startDecoding(),this.setSpeed("1"),this.hideAll(),this.event.emit("MEDIA_PLAY"),e.e=0,e.m="Resume Success."),e},_.prototype.stop=function(){this.logger.logInfo("Stop.");let e={e:-1,m:"Not playing."};return this.playerState==S||(this.playerState=S,this.configInfo=null,this.resetPlayer(),e.e=0,e.m="Stop Success."),e},_.prototype.resetPlayer=function(){this.closeWebsocket(),(window.cancelAnimationFrame||window.mozCancelAnimationFrame)(this.requestAnimationFrame),this.webglPlayer.webGLDestroy(),this.loadingState=!1,this.canvas=null,this.webglPlayer=null,this.frameRate=0,this.pixFmt=0,this.videoWidth=0,this.videoHeight=0,this.yLength=0,this.uvLength=0,this.audioEncoding="",this.audioChannels=0,this.audioSampleRate=0,this.sampleFmt=0,this.speedNum=2,this.setFrameRate=1,this.playerState=S,this.socketSending=!1,this.decoding=!1,this.currentTimestamp="",this.frameBuffer.length=0,this.frameBuffer=[],this.buffering=!1,this.drawingState=!1,this.speeding=!1,this.playInitState=!0,this.playFirstGetParams=!0,this.requestAnimationFrame=null,this.endtime=null,this.pcmPlayer&&(this.pcmPlayer.destroy(),this.pcmPlayer=null,this.logger.logInfo("Pcm player released.")),this.logger.logInfo("Closing decoder."),this.decodeWorker.postMessage({t:y.a.kUninitDecoderReq}),this.logger.logInfo("Uniniting decoder.")},_.prototype.reconnection=function(){const e={url:this.configInfo.url,endtime:this.configInfo.endtime,isStream:this.configInfo.isStream,k:this.configInfo.k,i:this.configInfo.i,ct:this.configInfo.ct,streamHighWaterFrame:this.configInfo.streamHighWaterFrame,playbackHighWaterFrame:this.configInfo.playbackHighWaterFrame,playbackLowWaterFrame:this.configInfo.playbackLowWaterFrame};this.play(e)},_.prototype.getCurTimestamp=function(){return this.currentTimestamp},_.prototype.fullscreen=function(){this.webglPlayer&&this.webglPlayer.fullscreen()},_.prototype.getState=function(){return this.playerState},_.prototype.volume=function(e){let t={e:-1,m:"Parameter Null"};return null===e||(null!==this.pcmPlayer&&this.pcmPlayer.volume(e),t.e=0,t.m="Set Volume Success."),t},_.prototype.setFrameRateFn=function(){return 1},_.prototype.displayLoop=function(){if(this.playerState!=S){let e=window.requestAnimationFrame||window.mozRequestAnimationFrame;this.requestAnimationFrame=e(this.displayLoop.bind(this))}if(this.playerState==b&&0!=this.frameBuffer.length&&!this.buffering){var e;this.loadingState=!1;for(let t=0;t<this.speedNum;++t){switch((e=this.frameBuffer[0]).t){case y.a.kAudioFrame:this.displayAudioFrame(e)&&this.frameBuffer.shift();break;case y.a.kVideoFrame:this.displayVideoFrame(e)&&this.frameBuffer.shift();break;default:return}if(0==this.frameBuffer.length)break}!this.isStream&&this.frameBuffer.length>=this.configInfo.playbackHighWaterFrame&&this.socketSending&&this.speed("0"),!this.isStream&&this.frameBuffer.length<this.configInfo.playbackLowWaterFrame&&(this.socketSending||this.speed("1")),this.isStream&&this.frameBuffer.length>=this.configInfo.streamHighWaterFrame&&(this.frameBuffer=[])}},_.prototype.displayAudioFrame=function(e){return this.playerState==b&&(this.speeding||(this.seeking&&(this.restartAudio(),this.loadingState=!1,this.seeking=!1),this.pcmPlayer&&this.pcmPlayer.feed(e.d)),!0)},_.prototype.displayVideoFrame=function(e){if(this.playerState!=b)return!1;if(this.seeking&&(this.restartAudio(),this.loadingState=!1,this.seeking=!1),this.drawingState){this.canvas.toBlob((t=>{e(t,`screencapture-${this.canvas.width}x${this.canvas.height}.png`)})),this.drawingState=!1;const e=function(){const e=document.createElement("a");return document.body.appendChild(e),e.style.display="none",function(t,o){const r=window.URL.createObjectURL(t);e.href=r,e.download=o,e.click()}}()}var t=e.d;return this.renderVideoFrame(t),!0},_.prototype.renderVideoFrame=function(e){this.webglPlayer.renderFrame(e,this.videoWidth,this.videoHeight,this.yLength,this.uvLength)},_.prototype.onFileData=function(e){var t;this.playerState==b&&(t={t:y.a.kFeedDataReq,d:e},this.decodeWorker.postMessage(t,[t.d]))},_.prototype.onsocketActiveClose=function(e,t){this.serverDataTimeout?(this.serverDataTimeout=!1,this.decoderErrorFlag&&(this.event.emit("CLIENT_lINK_ERROR_ONE"),this.logger.logError("[ER] 数据接收超时(0x"+this.serverDeviceUnLinkCode.toString(16)+")"),this.decoderErrorFlag=!1)):this.socketNoActive?(this.event.emit("CLIENT_lINK_ERROR_THREE"),this.logger.logError("[ER] 视频加载失败，请检查设备或网络配置!."),this.socketNoActive=!1):1005==e||1e3==e||t?(this.logger.logInfo("[success] 链接已断开."),this.decoderErrorFlag&&(this.event.emit("CLIENT_lINK_ERROR_ONE"),this.logger.logError("[ER] 数据接收超时(0x"+this.serverDeviceUnLinkCode.toString(16)+")"),this.decoderErrorFlag=!1)):this.serverDeviceUnLinkCode?(this.event.emit("CLIENT_lINK_ERROR_ONE"),this.logger.logError("[ER] 数据接收超时(0x"+this.serverDeviceUnLinkCode.toString(16)+")")):(this.event.emit("CLIENT_lINK_ERROR_ONE"),this.logger.logError("[ER] 链接异常 ("+e+")")),this.stop()},_.prototype.onsocketNoActive=function(){this.stop(),this.socketNoActive=!0},_.prototype.onInitDecoder=function(e){if(this.playerState!=S)if(this.logger.logInfo("Init decoder response "+e.e+"."),0==e.e){const e={t:y.a.fetchStream,url:this.configInfo.url,msg:"start"};this.downloadWorker.postMessage(e),this.socketSending=!0,this.showLoading()}else this.reportPlayError(e.e)},_.prototype.onSendDataCallback=function(){const e={t:y.a.kOpenDecoderReq};this.decodeWorker.postMessage(e)},_.prototype.onOpenDecoder=function(e){this.startDecoding()},_.prototype.startDecoding=function(){var e={t:y.a.kStartDecodingReq,i:5};this.decodeWorker.postMessage(e),this.decoding=!0},_.prototype.onGetParam=function(e){if(this.playerState!=S&&this.playerState!=T)if(0==e.e){if(!this.playFirstGetParams&&("video"==e.type&&(this.frameRate!=e.v.d||this.pixFmt!=e.v.p||this.videoWidth!=e.v.w||this.videoHeight!=e.v.h)||"audio"==e.type&&(this.audioChannels!=e.a.c||this.audioSampleRate!=e.a.r||this.sampleFmt!=e.a.f)))return this.resetPlayer(),void setTimeout((()=>{this.reconnection()}),1e3);"audio"==e.type?this.onAudioParam(e.a):this.onVideoParam(e.v),this.decoding=!0,this.buffering=!1,this.loadingState=!1,this.hideAll(),this.event.emit("MEDIA_INFO",e)}else this.reportPlayError(e.e)},_.prototype.onVideoParam=function(e){if(this.playerState==S)return;this.logger.logInfo("Video param duation:"+e.d+" pixFmt:"+e.p+" width:"+e.w+" height:"+e.h+"."),this.frameRate=e.d,this.pixFmt=e.p,this.canvas.width=e.w,this.canvas.height=e.h;let t=Math.ceil(1e5*this._msgController.conW/e.w)/1e5,o=Math.ceil(1e5*this._msgController.conH/e.h)/1e5;this.canvas.style.cssText=`transform: scale(${t},${o});transform-origin: 0 0;`,this.videoWidth=e.w,this.videoHeight=e.h,this.yLength=this.videoWidth*this.videoHeight,this.uvLength=this.videoWidth/2*(this.videoHeight/2)},_.prototype.onAudioParam=function(e){if(this.playerState!=S&&(this.logger.logInfo("Audio param sampleFmt:"+e.f+" channels:"+e.c+" sampleRate:"+e.r+"."),0!=e.r&&0!=e.c)){var t=e.f;this.sampleFmt=e.f;var o=e.c,r=e.r,s="16bitInt";switch(t){case 0:s="8bitInt";break;case 1:s="16bitInt";break;case 2:s="32bitInt";break;case 3:s="32bitFloat";break;default:this.logger.logError("Unsupported audio sampleFmt "+t+"!")}this.logger.logInfo("Audio encoding "+s+"."),this.playInitState&&(this.pcmPlayer=new i({encoding:s,channels:o,sampleRate:r,flushingTime:1e3}),this.audioEncoding=s,this.audioChannels=o,this.audioSampleRate=r,this.playInitState=!1)}},_.prototype.onAudioFrame=function(e){this.bufferFrame(e)},_.prototype.onVideoFrame=function(e){if(this.frameBuffer.filter((e=>4==e.t)).length>5){let e=this.frameBuffer.filter((e=>5==e.t));this.frameBuffer=e}this.bufferFrame(e)},_.prototype.bufferFrame=function(e){this.frameBuffer.push(e),this.getBufferTimerLength()>=500&&this.buffering&&(this.buffering=!1,this.loadingState=!1)},_.prototype.onSocketLinkState=function(e){var t;switch(this.logger.logInfo("Open socket response "+e.s+"."),e.s){case 1:t={t:y.a.getHeartBeatRequest},this.decodeWorker.postMessage(t);break;case 2:case 3:this.stop()}},_.prototype.onGetHeartBeatRequest=function(e){const t={t:y.a.DownloaderHeartBeat,b:e.b,l:e.l};this.downloadWorker.postMessage(t)},_.prototype.onGetSetPlayBackSpeedReq=function(e){const t={t:y.a.getSetPlayBackSpeedReq,b:e.b};this.downloadWorker.postMessage(t)},_.prototype.onGetSetPlayBackStartReq=function(e){const t={t:y.a.getSetPlayBackStartReq,b:e.b};this.downloadWorker.postMessage(t)},_.prototype.onDeviceReady=function(){const e={t:y.a.getSetPlayBackStartReq};this.decodeWorker.postMessage(e)},_.prototype.onGetSetPlayBackStartTimeReq=function(e){this.startDecoding();const t={t:y.a.getSetPlayBackStartTimeReq,b:e.b};this.downloadWorker.postMessage(t)},_.prototype.onResponseCurDateTime=function(e){this.currentTimestamp=e.d;const t=new Date(this.endtime).getTime();parseInt(e.d)>t&&this.stop(),this.event.emit("MEDIA_PROGRESS_INFO",t)},_.prototype.onEventTypeFifoFull=function(e){this.playerState==b&&this.speed("0")},_.prototype.onEventTypeFifoEnough=function(e){this.playerState==b&&this.speed("1")},_.prototype.onPlaybakcRecordList=function(e){let t=JSON.parse(e.d);t.rec_file_infos?this.isStream||this.event.emit("DEVICE_RECORD_LIST",t):this.showMsg("数据列表为空！")},_.prototype.onServerDataTimeout=function(e){this.serverDataTimeout=!0,this.stop()},_.prototype.onHeartPingResp=function(){const e={t:y.a.heartPingResp};this.downloadWorker.postMessage(e)},_.prototype.onGetHandsharkRes=function(e){const t=window.btoa(String.fromCharCode(...e.b)),o={t:y.a.fetchStream,url:this.configInfo.url+"&public_key="+t,msg:"start"};this.downloadWorker.postMessage(o),this.socketSending=!0,this.showLoading()},_.prototype.onCloseDecoderRsp=function(){this.event.emit("MEDIA_STOP")},_.prototype.onWasmLoaded=function(){this.event.emit("WASMLOADED")},_.prototype.onDecoderError=function(e){this.serverDeviceUnLinkCode=e.s,E[e.s]&&E[e.s].eventStr&&(this.event.emit(E[e.s].eventStr,E[e.s]),this.stop(),this.decoderErrorFlag=!0)},_.prototype.speed=function(e){if(!e)return;this.socketSending="0"!=e;const t={t:y.a.getSetPlayBackSpeedReq,l:e};this.decodeWorker.postMessage(t)},_.prototype.restartAudio=function(){this.pcmPlayer&&(this.pcmPlayer.destroy(),this.pcmPlayer=null),0!=this.audioSampleRate&&0!=this.audioChannels&&(this.pcmPlayer=new i({encoding:this.audioEncoding,channels:this.audioChannels,sampleRate:this.audioSampleRate,flushingTime:1e3}))},_.prototype.onDecodeFinished=function(e){this.pauseDecoding()},_.prototype.getBufferTimerLength=function(){if(!this.frameBuffer||0==this.frameBuffer.length)return 0;let e=this.frameBuffer[0],t=this.frameBuffer[this.frameBuffer.length-1];return Math.abs(t.s-e.s)},_.prototype.closeWebsocket=function(){const e={t:y.a.closeWebsocket};this.downloadWorker.postMessage(e)},_.prototype.pauseDecoding=function(){var e={t:y.a.kPauseDecodingReq};this.decodeWorker.postMessage(e),this.decoding=!1},_.prototype.formatTime=function(e){return(Math.floor(e/3600)<10?"0"+Math.floor(e/3600):Math.floor(e/3600))+":"+(Math.floor(e/60%60)<10?"0"+Math.floor(e/60%60):Math.floor(e/60%60))+":"+(e=Math.floor(e%60)<10?"0"+Math.floor(e%60):Math.floor(e%60))},_.prototype.reportPlayError=function(e,t,o){},_.prototype.registerVisibilityEvent=function(e){var t="hidden";function o(o){var r=!0,i=!1,s={focus:r,focusin:r,pageshow:r,blur:i,focusout:i,pagehide:i},n=r;n=(o=o||window.event).type in s?s[o.type]:document[t]?i:r,e(n)}t in document?document.addEventListener("visibilitychange",o):(t="mozHidden")in document?document.addEventListener("mozvisibilitychange",o):(t="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",o):(t="msHidden")in document?document.addEventListener("msvisibilitychange",o):"onfocusin"in document?document.onfocusin=document.onfocusout=o:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=o,void 0!==document[t]&&o({type:document[t]?"blur":"focus"})},_.prototype.snapshot=function(){this.drawingState=!0},_.prototype.getVersion=function(){return"1.1.1.20210323"};t.default=_}])}));